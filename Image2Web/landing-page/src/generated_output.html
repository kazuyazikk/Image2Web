<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Generated Output - Image2Web</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:radial-gradient(1200px 800px at 20% 20%, #13213a 0%, #12002f 50%, #0e0b2b 100%),linear-gradient(140deg, #0b0f2a 0%, #2c004f 60%, #0b1025 100%);color:#f8fafc;margin:0;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    h1{color:#38bdf8;margin:0;font-family:'Poppins',sans-serif;font-size:2rem;font-weight:700}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:#fff;padding:10px 16px;border:0;border-radius:8px;cursor:pointer;font-family:'Inter',sans-serif;font-weight:500;transition:all 0.3s ease}
    button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(102, 126, 234, 0.3)}
    .layout{display:grid;grid-template-columns:1fr;gap:20px;margin-top:20px}
    .preview{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;backdrop-filter:blur(10px)}
    iframe{width:100%;height:70vh;border:0;border-radius:8px;background:#fff}
    .code-blocks{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    textarea{width:100%;min-height:200px;background:rgba(0,0,0,0.3);color:#f8fafc;border:1px solid rgba(255,255,255,0.2);padding:16px;border-radius:8px;resize:none;font-family:'Courier New',monospace;backdrop-filter:blur(10px)}
    .note{color:#cbd5e1;font-size:0.95rem;margin-bottom:20px}
    @media (max-width: 768px) {
      .code-blocks{grid-template-columns:1fr}
      .controls{flex-direction:column}
      button{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <h1>Generated Output</h1>
    <div class="controls">
      <button id="openInNew">Open Preview in New Tab</button>
      <button id="backBtn">Back to Workspace</button>
    </div>
  </header>

  <p class="note">This page shows the most recently generated HTML/CSS stored in your browser. If you generated code on another device or cleared storage, it may be empty.</p>

  <div class="layout">
    <div class="preview">
      <iframe id="generatedPreview" sandbox="allow-same-origin allow-scripts"></iframe>
    </div>

    <div class="code-blocks">
      <div>
        <h3 style="margin:0 0 8px 0;color:#7dd3fc">HTML</h3>
        <textarea id="htmlView" readonly></textarea>
      </div>
      <div>
        <h3 style="margin:0 0 8px 0;color:#7dd3fc">CSS</h3>
        <textarea id="cssView" readonly></textarea>
      </div>
    </div>
  </div>

  <script>
    // Minimal viewer controls

    // stripped edit functions removed

    function loadGenerated() {
      const html = localStorage.getItem('generated_html') || '';
      const css = localStorage.getItem('generated_css') || '';
      const preview = document.getElementById('generatedPreview');
      const htmlView = document.getElementById('htmlView');
      const cssView = document.getElementById('cssView');

      htmlView.value = html;
      cssView.value = css;

      const doc = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>${css}</style></head><body>${html}</body></html>`;
      preview.srcdoc = doc;
    }

    document.getElementById('backBtn').addEventListener('click', () => {
      window.location.href = 'workspace.html';
    });

    document.getElementById('openInNew').addEventListener('click', () => {
      const html = localStorage.getItem('generated_html') || '';
      const css = localStorage.getItem('generated_css') || '';
      const doc = `<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>${css}</style></head><body>${html}</body></html>`;
      const w = window.open('', '_blank');
      if (w) {
        w.document.open();
        w.document.write(doc);
        w.document.close();
      } else {
        alert('Popup blocked. Allow popups for this site to open preview in a new tab.');
      }
    });

      // Save Design handler: add to projects_list
      document.getElementById('saveDesignBtn').addEventListener('click', () => {
        try {
          const html = localStorage.getItem('generated_html') || '';
          const css = localStorage.getItem('generated_css') || '';
          const projects = JSON.parse(localStorage.getItem('projects_list') || '[]');
          const entry = { id: Date.now(), title: `Saved ${new Date().toLocaleString()}`, html, css };
          projects.unshift(entry);
          localStorage.setItem('projects_list', JSON.stringify(projects));
          localStorage.setItem('projects_list_updated_at', String(Date.now()));
          localStorage.setItem('projects_list_last_id', String(entry.id));
          alert('Design saved to Previous Designs.');
        } catch (err) {
          console.error('Save failed:', err);
          alert('Could not save design: ' + err.message);
        }
      });

    // Load on start
    loadGenerated();
  </script>
</body>
</html>
